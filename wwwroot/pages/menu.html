<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menu | Coffee Portal</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Global (shared) and page-specific styles -->
  <link rel="stylesheet" href="/css/global.css" />
  <link rel="stylesheet" href="/css/menu.css" />

  <style>
    /* Keep styles minimal and Bootstrap-compatible */

    /* images scale consistently and do not dominate */
    .carousel-img,
    .carousel-img-lg {
      width: 100%;
      height: 220px;               /* consistent crop height for normal carousels */
      object-fit: cover;           /* preserves aspect ratio, crops excess */
      display: block;
      border-radius: 12px;
    }
    .carousel-img-lg {
      height: 300px;               /* larger for the big carousels */
    }

    /* caption overlay for each item (prevents overlap between items) */
    .carousel-item {
      position: relative;          /* caption absolute positioned relative to this */
    }

    .carousel-caption-text {
      position: absolute;
      left: 8px;
      right: 8px;
      bottom: 8px;
      margin: 0 auto;
      text-align: center;
      background: rgba(0,0,0,0.5);
      color: #fff;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 0.95rem;
      max-width: calc(100% - 16px);
      box-sizing: border-box;
      pointer-events: none;        /* clicks pass through to image (so modal triggers) */
    }

    /* keep carousel controls visible and sized */
    .carousel-control-prev-icon,
    .carousel-control-next-icon {
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.6));
    }

    /* small visual niceties */
    .section { margin-bottom: 6px; }
    .menu-card { max-width: 980px; }
    .btn-mic { width: 48px; }

    /* Selected indicator badge (added when an item is chosen) */
    .selected-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(25, 135, 84, 0.95); /* Bootstrap success */
      color: #fff;
      border-radius: 999px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      z-index: 3;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

  <div class="container my-4">
    <div class="menu-card mx-auto shadow-sm">

      <!-- Header -->
      <header class="menu-header text-center py-3">
        <h2 class="mb-1">MENU</h2>
        <div class="current-serving small">
          Currently Serving <span class="serving-type">Breakfast</span>
          <span class="serving-hours">| 8:00am - 10:30am</span>
        </div>
      </header>

      <div class="menu-body p-3">

        <!-- Row 1: Recent + Saved Orders -->
        <div class="row gx-3 gy-3 mb-2">
          <div class="col-12 col-md-6">
            <div class="section">
              <h5 class="section-title">Recent Orders</h5>
              <div id="carouselRecent" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Cappuccino"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Cappuccino">
                    <div class="carousel-caption-text">Cappuccino — Small</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Vanilla Latte"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Vanilla Latte">
                    <div class="carousel-caption-text">Vanilla Latte — Medium</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselRecent" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselRecent" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6">
            <div class="section">
              <h5 class="section-title">Saved Orders</h5>
              <div id="carouselSaved" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Butter Croissant"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Butter Croissant">
                    <div class="carousel-caption-text">Butter Croissant</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Blueberry Muffin"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Blueberry Muffin">
                    <div class="carousel-caption-text">Blueberry Muffin</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselSaved" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselSaved" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 2: Trending + Specials -->
        <div class="row gx-3 gy-3 mb-2">
          <div class="col-12 col-md-6">
            <div class="section">
              <h5 class="section-title">Trending</h5>
              <div id="carouselTrending" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Iced Mocha"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Iced Mocha">
                    <div class="carousel-caption-text">Iced Mocha</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Double Espresso"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Double Espresso">
                    <div class="carousel-caption-text">Double Espresso</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselTrending" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselTrending" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-6">
            <div class="section">
              <h5 class="section-title">Specials</h5>
              <div id="carouselSpecials" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Breakfast Sandwich"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Breakfast Sandwich">
                    <div class="carousel-caption-text">Breakfast Sandwich</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img menu-item"
                         alt="Bagel & Cream Cheese"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Bagel & Cream Cheese">
                    <div class="carousel-caption-text">Bagel & Cream Cheese</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselSpecials" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselSpecials" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 3: Drink Menu -->
        <div class="row gx-3 gy-3 mb-2">
          <div class="col-12">
            <div class="section">
              <h5 class="section-title">Drink Menu</h5>
              <div id="carouselDrinks" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img-lg menu-item"
                         alt="House Brew"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="House Brew">
                    <div class="carousel-caption-text">House Brew</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img-lg menu-item"
                         alt="Chai Tea Latte"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Chai Tea Latte">
                    <div class="carousel-caption-text">Chai Tea Latte</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselDrinks" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselDrinks" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Row 4: Food Menu -->
        <div class="row gx-3 gy-3 mb-2">
          <div class="col-12">
            <div class="section">
              <h5 class="section-title">Food Menu</h5>
              <div id="carouselFood" class="carousel slide" data-bs-ride="false" data-bs-touch="true" data-bs-wrap="true">
                <div class="carousel-inner">
                  <div class="carousel-item active text-center">
                    <img src="https://dairyfarmersofcanada.ca/sites/default/files/styles/recipe_image/public/image_file_browser/conso_recipe/2022/Capuccino.jpg.jpeg?itok=J1pWPwe2"
                         class="d-block mx-auto rounded carousel-img-lg menu-item"
                         alt="Pancake Stack"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Pancake Stack">
                    <div class="carousel-caption-text">Pancake Stack</div>
                  </div>
                  <div class="carousel-item text-center">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTzEdVdApltOZXmjDqHPo_kZTURgwuOcdel4g&s"
                         class="d-block mx-auto rounded carousel-img-lg menu-item"
                         alt="Cheese Omelette"
                         data-bs-toggle="modal"
                         data-bs-target="#itemModal"
                         data-item="Cheese Omelette">
                    <div class="carousel-caption-text">Cheese Omelette</div>
                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselFood" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselFood" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Special Requests -->
        <div class="row gx-3 gy-3 mb-2">
          <div class="col-12">
            <div class="section">
              <h5 class="section-title">Special Requests</h5>
              <div class="input-group">
                <input id="specialRequests" name="specialRequests" type="text" class="form-control" placeholder="Start typing or speaking..." aria-label="Special requests">
                <button id="micButton" class="btn btn-mic" type="button" title="Tap to speak">
                  <i class="bi bi-mic-fill"></i>
                </button>
              </div>
              <div class="form-text small text-muted mt-2">
                Add any allergy notes, extra sauces, or preparation preferences.
              </div>
              <!-- Hidden field to carry special requests forward -->
              <input type="hidden" id="hiddenSpecialRequests" name="hiddenSpecialRequests">
            </div>
          </div>
        </div>

      </div> <!-- /menu-body -->
      <!-- Footer actions -->
      <footer class="menu-footer d-flex">
        <button id="cancelBtn" class="btn btn-cancel flex-fill" onclick="window.location.href='../index.html'">CANCEL</button>
        <button id="orderBtn" class="btn btn-order flex-fill">ORDER</button>
      </footer>

    </div> <!-- /menu-card -->
  </div> <!-- /container -->

  <!-- No Items Selected Modal -->
<div class="modal fade" id="noItemsModal" tabindex="-1" aria-labelledby="noItemsLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-body">
        <div class="mb-3">
          <span class="text-danger display-4">✖</span>
        </div>
        <h4 id="noItemsLabel">No Items Selected</h4>
        <p class="text-muted">Please add at least one item to your order before proceeding to checkout.</p>
      </div>
    </div>
  </div>
</div>

  <!-- Item Customization Modal -->
  <div class="modal fade" id="itemModal" tabindex="-1" aria-labelledby="itemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content p-4">
        <div class="modal-header">
          <h5 class="modal-title" id="itemModalLabel">Customize Item</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <!-- Categories of modifiers -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <h6>Style</h6>
              <div><input type="checkbox" id="hot"> <label for="hot">Hot</label></div>
              <div><input type="checkbox" id="iced"> <label for="iced">Iced</label></div>
            </div>
            <div class="col-md-6 mb-3">
              <h6>Milk</h6>
              <div><input type="checkbox" id="dairy"> <label for="dairy">Dairy</label></div>
              <div><input type="checkbox" id="oat"> <label for="oat">Oat</label></div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <h6>Flavors</h6>
              <div><input type="checkbox" id="vanilla"> <label for="vanilla">Vanilla</label></div>
              <div><input type="checkbox" id="mint"> <label for="mint">Mint</label></div>
              <div><input type="checkbox" id="cinnamon"> <label for="cinnamon">Cinnamon</label></div>
              <div><input type="checkbox" id="hazelnut"> <label for="hazelnut">Hazelnut</label></div>
            </div>
            <div class="col-md-6 mb-3">
              <h6>Additions</h6>
              <div><input type="checkbox" id="whip"> <label for="whip">Whip Cream</label></div>
              <div><input type="checkbox" id="extraShot"> <label for="extraShot">Extra Shot</label></div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12 mb-3">
              <h6>Restrictions</h6>
              <div><input type="checkbox" id="sugarFree"> <label for="sugarFree">Sugar Free</label></div>
              <div><input type="checkbox" id="caffeineFree"> <label for="caffeineFree">Caffeine Free</label></div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-order" id="applyModifiers">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS Functionality -->
<script>
  // Helpers for selected items array
  function getSelectedItems() {
    return JSON.parse(localStorage.getItem('selectedItems') || '[]');
  }
  function saveSelectedItems(items) {
    localStorage.setItem('selectedItems', JSON.stringify(items));
  }

  let currentItemName = null;
  let currentTriggerImg = null;
  const itemModalEl = document.getElementById('itemModal');

  if (itemModalEl) {
    itemModalEl.addEventListener('show.bs.modal', function (event) {
      const trigger = event.relatedTarget;
      if (trigger && trigger.getAttribute) {
        currentItemName = trigger.getAttribute('data-item') || trigger.alt || 'Item';
        currentTriggerImg = trigger;
        document.getElementById('itemModalLabel').textContent = 'Customize ' + currentItemName;
      }
      // Reset all checkboxes each time modal opens
      document.querySelectorAll('#itemModal input[type=checkbox]').forEach(cb => cb.checked = false);
    });
  }

  // Apply modifiers: collect checked modifiers and close modal
  document.getElementById('applyModifiers').addEventListener('click', function () {
    if (!currentItemName) {
      alert("Please select an item before applying modifiers.");
      return;
    }

    const checked = Array.from(document.querySelectorAll('#itemModal input[type=checkbox]:checked'))
      .map(cb => {
        const lbl = cb.nextElementSibling;
        return (lbl && lbl.textContent) ? lbl.textContent.trim() : cb.id;
      });

    const itemObj = {
      name: currentItemName,
      modifiers: checked,
      specialRequests: document.getElementById('specialRequests').value || ''
    };

    const items = getSelectedItems();
    items.push(itemObj);
    saveSelectedItems(items);

    // Add visual indicator to the selected image
    if (currentTriggerImg) {
      const wrapper = currentTriggerImg.closest('.carousel-item');
      if (wrapper && !wrapper.querySelector('.selected-indicator')) {
        const indicator = document.createElement('div');
        indicator.className = 'selected-indicator';
        indicator.innerHTML = '✔';
        wrapper.appendChild(indicator);
      }
    }

    const modalInstance = bootstrap.Modal.getInstance(itemModalEl);
    if (modalInstance) modalInstance.hide();
  });

  // Validate before going to checkout
document.getElementById('orderBtn').addEventListener('click', function (e) {
  const items = getSelectedItems();
  if (!Array.isArray(items) || items.length === 0) {
    // Show fancy Bootstrap modal instead of alert
    const noItemsModal = new bootstrap.Modal(document.getElementById('noItemsModal'));
    noItemsModal.show();
    return;
  }
  // Proceed if items exist
  window.location.href = 'checkout.html';
});


  // Keep hidden special requests field in sync
  const specialInput = document.getElementById('specialRequests');
  const hiddenSpecial = document.getElementById('hiddenSpecialRequests');
  if (specialInput && hiddenSpecial) {
    specialInput.addEventListener('input', () => {
      hiddenSpecial.value = specialInput.value;
      localStorage.setItem('specialRequests', specialInput.value);
    });
  }

  // Optional: simple mic button UX
  const micButton = document.getElementById('micButton');
  if (micButton && specialInput) {
    micButton.addEventListener('click', () => {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        const old = specialInput.placeholder;
        specialInput.placeholder = 'Speech not available — type instead';
        setTimeout(() => specialInput.placeholder = old, 1500);
        return;
      }
      const recog = new SpeechRecognition();
      recog.lang = 'en-US';
      recog.interimResults = false;
      recog.maxAlternatives = 1;
      recog.start();
      micButton.classList.add('active');
      recog.onresult = (e) => {
        const spoken = e.results[0][0].transcript;
        specialInput.value = specialInput.value ? (specialInput.value + ' ' + spoken) : spoken;
        hiddenSpecial.value = specialInput.value;
        localStorage.setItem('specialRequests', specialInput.value);
      };
      recog.onend = () => micButton.classList.remove('active');
      recog.onerror = () => micButton.classList.remove('active');
    });
  }

  // Initialize all carousels with proper settings
  document.querySelectorAll('.carousel').forEach(car => {
    new bootstrap.Carousel(car, { interval: false, ride: false, wrap: true, touch: true });
  });
</script>
</body>
</html>
